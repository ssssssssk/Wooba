{% include header.html %}
<!-- <div class="container" style="padding-top: 17vw;"> -->
 <div class="container">
  <br>
  <div class="row">

    <div class="three columns">
      <div class=info>
	{{ page.event_type }}:
      </div>
    </div>
  </div>
  <div class ="row">
    <div class="offset-by-one ten columns">
      
      <a href="{{ post.url | relative_url }}">
	<div class="artist-font">
	  {% if page.artist_name == empty %}
	  {{ page.show_title }}
	  {% else %}
	  {{ page.artist_name }}
	  {% endif %}
	</div>
	<div class="show">
	  {% if page.artist_name == empty %}
	  {% else %}
	  {% if page.show_title == empty %}
	  {% else %}
	  {{ page.show_title }}
	  {% endif %}
	  {% endif %}
	</div>
	
      </a>
      <div class="info">
	{% if page.time == empty %}
	{{ page.start_date }}
	{% else %}
	{{ page.start_date }}. {{ page.time }}
	{% endif %}
	
	{% if page.address == empty %}
	{% else %}
	<br>
	<a href="{{ post.map_link }}">
	  {{ page.address }}
	</a>
	<brg>
	  {% endif %}
	  <div class="no-print">
	    {{ page.hours }}

	  </div>
      </div>
      <br>
      
      <br>

      <div class="pics">
	{% if page.image_folder == empty %}
	{% else %}
	<div id="canvas"></div>
	<div class="flex-wrapper multi-textures" data-vs-id="multiple-textures-vs" data-fs-id="multiple-textures-fs">
	  <img src="/assets/images/displacement.jpg" width="100%" data-samper="displacement">
	  {% for file in site.static_files %}
	  {% if file.path contains page.image_folder %}
	  {% if file.extname == ".jpg" %}
	  <div class="">
	    <img src="{{ file.path | relative_url }}" width="100%">
	  </div> &nbsp;

	  {% endif %}
	  {% endif %}
	  {% endfor %}
	</div>
	<script id="multiple-textures-vs" type="x-shader/x-vertex">
	 #ifdef GL_ES
	 precision mediump float;
	 #endif

	 // default mandatory variables
	 attribute vec3 aVertexPosition;
	 attribute vec2 aTextureCoord;

	 uniform mat4 uMVMatrix;
    	 uniform mat4 uPMatrix;

	 // varyings : notice we've got 3 texture coords varyings
	 // one for the displacement texture
	 // one for our visible texture
	 // and one for the upcoming texture
	 varying vec3 vVertexPosition;
	 varying vec2 vTextureCoord;
	 varying vec2 vActiveTextureCoord;
	 varying vec2 vNextTextureCoord;

	 // textures matrices
	 uniform mat4 activeTexMatrix;
	 uniform mat4 nextTexMatrix;

	 // custom uniforms
	 uniform float uTransitionTimer;
	 uniform vec2 uResolution;


	 void main() {

	   vec3 vertexPosition = aVertexPosition;

	   gl_Position = uPMatrix * uMVMatrix * vec4(vertexPosition, 1.0);

	   // varyings
	   vTextureCoord = aTextureCoord;
	   vActiveTextureCoord = (activeTexMatrix * vec4(aTextureCoord, 0.0, 1.0)).xy;
	   vNextTextureCoord = (nextTexMatrix * vec4(aTextureCoord, 0.0, 1.0)).xy;

	   vVertexPosition = vertexPosition;
	 }
        </script>
        <script id="multiple-textures-fs" type="x-shader/x-fragment">
	 #ifdef GL_ES
	 precision mediump float;
	 #endif

	 varying vec3 vVertexPosition;
	 varying vec2 vTextureCoord;
	 varying vec2 vActiveTextureCoord;
	 varying vec2 vNextTextureCoord;

	 // custom uniforms
	 uniform float uTransitionTimer;
	 uniform vec2 uResolution;

	 // our textures samplers
	 // notice how it matches the sampler attributes of the textures we created dynamically
	 uniform sampler2D activeTex;
	 uniform sampler2D nextTex;
	 uniform sampler2D displacement;

	 void main( void ) {
	   // our displacement texture
	   vec4 displacementTexture = texture2D(displacement, vTextureCoord);

	   // slides transitions based on displacement and transition timer
	   vec2 firstDisplacementCoords = vActiveTextureCoord + displacementTexture.r * ((cos((uTransitionTimer + 90.0) / (90.0 / 3.141592)) + 1.0) / 1.25);
	   vec4 firstDistortedColor = texture2D(activeTex, vec2(vActiveTextureCoord.x, firstDisplacementCoords.y));

	   // same as above but we substract the effect
	   vec2 secondDisplacementCoords = vNextTextureCoord - displacementTexture.r * ((cos(uTransitionTimer / (90.0 / 3.141592)) + 1.0) / 1.25);
	   vec4 secondDistortedColor = texture2D(nextTex, vec2(vNextTextureCoord.x, secondDisplacementCoords.y));

	   // mix both texture
	   vec4 finalColor = mix(firstDistortedColor, secondDistortedColor, 1.0 - ((cos(uTransitionTimer / (90.0 / 3.141592)) + 1.0) / 2.0));

	   // handling premultiplied alpha
	   finalColor = vec4(finalColor.rgb * finalColor.a, finalColor.a);

	   gl_FragColor = finalColor;
	 }
        </script>
	<script src="/assets/js/curtains.js" type="text/javascript"></script>
        <script src="/assets/js/multiple.textures.setup.js" type="text/javascript"></script>
	{% endif %}
      </div>
      {% if page.content == empty %}
      {% else %}
    
      <div class="content">
	{{ content }}
      </div>
      {% endif %}
    </div>
  </div>
</div>

{% include footer.html %}
